//-/////////////////////////////////////////////////////////////////////////////
//-                                                                           //
//-              This file is part of the Buildbotics firmware.               //
//-                                                                           //
//-                Copyright (c) 2015 - 2018, Buildbotics LLC                 //
//-                           All rights reserved.                            //
//-                                                                           //
//-   This file ("the software") is free software: you can redistribute it    //
//-   and/or modify it under the terms of the GNU General Public License,     //
//-    version 2 as published by the Free Software Foundation. You should     //
//-    have received a copy of the GNU General Public License, version 2      //
//-   along with the software. If not, see <http://www.gnu.org/licenses/>.    //
//-                                                                           //
//-   The software is distributed in the hope that it will be useful, but     //
//-        WITHOUT ANY WARRANTY; without even the implied warranty of         //
//-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU      //
//-             Lesser General Public License for more details.               //
//-                                                                           //
//-     You should have received a copy of the GNU Lesser General Public      //
//-              License along with the software.  If not, see                //
//-                     <http://www.gnu.org/licenses/>.                       //
//-                                                                           //
//-              For information regarding this software email:               //
//-                "Joseph Coffland" <joseph@buildbotics.com>                 //
//-                                                                           //
//-/////////////////////////////////////////////////////////////////////////////

script#files-template(type="text/x-template")
  .files(v-if="fs.files")
    .files-name(v-if="mode == 'save'")
      label Name:
      input(v-model="filename", @input="filename_changed")

    .files-body
      .files-locations
        .files-location.files-upload(v-if="mode != 'save'",
          title="Upload a file from this computer to the controller.",
            @click="upload") #[.fa.fa-upload] Upload

          form.file-upload(v-el:upload-form)
            input(type="file", v-el:upload-form-input @change="do_upload")

        .files-location(v-for="name in locations", @click="open(name)",
          :class="{active: name == location}", :title="location_title(name)")
          .fa.fa-home(v-if="name == 'Home'")
          .fa.fa-eject(v-else, @click.stop="eject(name)",
            title="Eject USB drive")
          | {{name}}

      .files-box
        .files-path-bar
          .files-path
            button.pure-button(v-for="path in paths", track-by="$index",
              :disabled="$index == paths.length - 1",
              :title="path_title($index)", @click="load_path($index)")
              | {{path}}

          .new-folder
            button.pure-button(title="Create a new folder.",
              @click="new_folder", :disabled="10 < paths.length").
              #[.fa.fa-plus] New Folder

            message(:show.sync="showNewFolder")
              h3(slot="header") Folder Name
              p(slot="body")
                input(v-model="folder", @keyup.enter="create_folder")
              div(slot="footer")
                button.pure-button(@click="showNewFolder = false")
                  | #[.fa.fa-times] Cancel
                button.pure-button.pure-button-primary(
                  :disabled="!folder_valid", @click="create_folder")
                  | #[.fa.fa-plus] Create

        .files-list
          table
            thead
              tr
                th.name Name
                th.size Size
                th.modified Modified

            tbody
              tr(v-for="file in files",
                :class="{selected: $index == selected}",
                @click="select($index)", @dblclick="activate(file)")
                td.name.
                  #[.fa(:class="file.dir ? 'fa-folder' : 'fa-file-o'")]
                  {{file.name}}
                td.size: span(v-if="!file.dir") {{file.size | size}}
                td.modified {{file.modified | ago}}
